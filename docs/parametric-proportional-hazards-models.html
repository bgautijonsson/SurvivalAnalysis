<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Parametric Proportional Hazards Models | Survival Analysis (LÝÐ079F)</title>
  <meta name="description" content="This is a collection of lectures notes from the course at University of Iceland" />
  <meta name="generator" content="bookdown 0.17.2 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Parametric Proportional Hazards Models | Survival Analysis (LÝÐ079F)" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a collection of lectures notes from the course at University of Iceland" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Parametric Proportional Hazards Models | Survival Analysis (LÝÐ079F)" />
  
  <meta name="twitter:description" content="This is a collection of lectures notes from the course at University of Iceland" />
  

<meta name="author" content="Thor Aspelund, Brynjólfur Gauti Jónsson" />
<meta name="author" content="University of Iceland" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model-checking-in-the-cox-regression-model.html"/>
<link rel="next" href="time-dependent-variables-and-covariates.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />










<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });

  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text('Code');
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text('Hide');
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
.row { display: flex; }
.collapse { display: none; }
.in { display:block }
.pull-right > .dropdown-menu {
    right: 0;
    left: auto;
}
.open > .dropdown-menu {
    display: block;
}
.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    float: left;
    min-width: 160px;
    padding: 5px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: #fff;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    border: 1px solid #ccc;
    border: 1px solid rgba(0,0,0,.15);
    border-radius: 4px;
    -webkit-box-shadow: 0 6px 12px rgba(0,0,0,.175);
    box-shadow: 0 6px 12px rgba(0,0,0,.175);
}
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>


<script>
document.write('<div class="btn-group pull-right" style="position: absolute; top: 20%; right: 2%; z-index: 200"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" data-_extension-text-contrast=""><span>Code</span> <span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show</a></li><li><a id="rmd-hide-all-code" href="#">Hide</a></li></ul></div>')
</script>



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://english.hi.is">University of Iceland</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#the-book"><i class="fa fa-check"></i>The Book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i>Software</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#setup-in-rstudio"><i class="fa fa-check"></i>Setup in RStudio</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#some-probability-distributions"><i class="fa fa-check"></i>Some Probability Distributions</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#discrete"><i class="fa fa-check"></i>Discrete</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#continuous"><i class="fa fa-check"></i>Continuous</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction-to-survival-analysis.html"><a href="introduction-to-survival-analysis.html"><i class="fa fa-check"></i><b>1</b> Introduction to Survival Analysis</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction-to-survival-analysis.html"><a href="introduction-to-survival-analysis.html#inngangur"><i class="fa fa-check"></i><b>1.1</b> Inngangur</a></li>
<li class="chapter" data-level="1.2" data-path="introduction-to-survival-analysis.html"><a href="introduction-to-survival-analysis.html#skerðing-censoring"><i class="fa fa-check"></i><b>1.2</b> Skerðing (censoring)</a></li>
<li class="chapter" data-level="1.3" data-path="introduction-to-survival-analysis.html"><a href="introduction-to-survival-analysis.html#kaplan-meier-metillinn"><i class="fa fa-check"></i><b>1.3</b> Kaplan Meier metillinn</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction-to-survival-analysis.html"><a href="introduction-to-survival-analysis.html#kaplan-meier-gröf"><i class="fa fa-check"></i><b>1.3.1</b> Kaplan Meier gröf</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction-to-survival-analysis.html"><a href="introduction-to-survival-analysis.html#kaplan-meier-gröf-eftir-hópum"><i class="fa fa-check"></i><b>1.3.2</b> Kaplan Meier gröf eftir hópum</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction-to-survival-analysis.html"><a href="introduction-to-survival-analysis.html#miðgildi-lifunar-og-logrank-próf"><i class="fa fa-check"></i><b>1.4</b> Miðgildi lifunar og logrank próf</a></li>
<li class="chapter" data-level="1.5" data-path="introduction-to-survival-analysis.html"><a href="introduction-to-survival-analysis.html#víti-að-varast-og-breyting-á-tímaskala"><i class="fa fa-check"></i><b>1.5</b> Víti að varast og breyting á tímaskala</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="some-non-parametric-procedures.html"><a href="some-non-parametric-procedures.html"><i class="fa fa-check"></i><b>2</b> Some Non-Parametric Procedures</a>
<ul>
<li class="chapter" data-level="2.1" data-path="some-non-parametric-procedures.html"><a href="some-non-parametric-procedures.html#section"><i class="fa fa-check"></i><b>2.1</b> 2.1.2</a></li>
<li class="chapter" data-level="2.2" data-path="some-non-parametric-procedures.html"><a href="some-non-parametric-procedures.html#nelson---aalen"><i class="fa fa-check"></i><b>2.2</b> 2.1.3 Nelson - Aalen</a></li>
<li class="chapter" data-level="2.3" data-path="some-non-parametric-procedures.html"><a href="some-non-parametric-procedures.html#section-1"><i class="fa fa-check"></i><b>2.3</b> 2.2</a></li>
<li class="chapter" data-level="2.4" data-path="some-non-parametric-procedures.html"><a href="some-non-parametric-procedures.html#estimating-the-hazard-function"><i class="fa fa-check"></i><b>2.4</b> 2.2 Estimating the hazard function</a></li>
<li class="chapter" data-level="2.5" data-path="some-non-parametric-procedures.html"><a href="some-non-parametric-procedures.html#an-application-to-cat-adoptions"><i class="fa fa-check"></i><b>2.5</b> An Application to Cat Adoptions</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="some-non-parametric-procedures.html"><a href="some-non-parametric-procedures.html#data"><i class="fa fa-check"></i><b>2.5.1</b> Data</a></li>
<li class="chapter" data-level="2.5.2" data-path="some-non-parametric-procedures.html"><a href="some-non-parametric-procedures.html#kaplan-meier"><i class="fa fa-check"></i><b>2.5.2</b> Kaplan-Meier</a></li>
<li class="chapter" data-level="2.5.3" data-path="some-non-parametric-procedures.html"><a href="some-non-parametric-procedures.html#nelson-aalen"><i class="fa fa-check"></i><b>2.5.3</b> Nelson-Aalen</a></li>
<li class="chapter" data-level="2.5.4" data-path="some-non-parametric-procedures.html"><a href="some-non-parametric-procedures.html#compare"><i class="fa fa-check"></i><b>2.5.4</b> Compare</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-cox-regression-model.html"><a href="the-cox-regression-model.html"><i class="fa fa-check"></i><b>3</b> The Cox Regression Model</a>
<ul>
<li class="chapter" data-level="3.1" data-path="the-cox-regression-model.html"><a href="the-cox-regression-model.html#inngangur-1"><i class="fa fa-check"></i><b>3.1</b> Inngangur</a></li>
<li class="chapter" data-level="3.2" data-path="the-cox-regression-model.html"><a href="the-cox-regression-model.html#modeling-the-hazard-function"><i class="fa fa-check"></i><b>3.2</b> Modeling the hazard function</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="the-cox-regression-model.html"><a href="the-cox-regression-model.html#a-model-for-comparison-of-two-groups"><i class="fa fa-check"></i><b>3.2.1</b> A model for comparison of two groups</a></li>
<li class="chapter" data-level="3.2.2" data-path="the-cox-regression-model.html"><a href="the-cox-regression-model.html#the-general-proportional-hazards-model"><i class="fa fa-check"></i><b>3.2.2</b> The general proportional hazards model</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="the-cox-regression-model.html"><a href="the-cox-regression-model.html#fitting-the-cox-regression-model"><i class="fa fa-check"></i><b>3.3</b> Fitting the Cox regression model</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="model-checking-in-the-cox-regression-model.html"><a href="model-checking-in-the-cox-regression-model.html"><i class="fa fa-check"></i><b>4</b> Model Checking in the Cox Regression Model</a>
<ul>
<li class="chapter" data-level="4.1" data-path="model-checking-in-the-cox-regression-model.html"><a href="model-checking-in-the-cox-regression-model.html#einfalt-kaplan-meier"><i class="fa fa-check"></i><b>4.1</b> Einfalt Kaplan Meier</a></li>
<li class="chapter" data-level="4.2" data-path="model-checking-in-the-cox-regression-model.html"><a href="model-checking-in-the-cox-regression-model.html#veldislifunarfallið"><i class="fa fa-check"></i><b>4.2</b> Veldislifunarfallið</a></li>
<li class="chapter" data-level="4.3" data-path="model-checking-in-the-cox-regression-model.html"><a href="model-checking-in-the-cox-regression-model.html#leifar-í-cox"><i class="fa fa-check"></i><b>4.3</b> Leifar í Cox</a></li>
<li class="chapter" data-level="4.4" data-path="model-checking-in-the-cox-regression-model.html"><a href="model-checking-in-the-cox-regression-model.html#survminer"><i class="fa fa-check"></i><b>4.4</b> Survminer</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="model-checking-in-the-cox-regression-model.html"><a href="model-checking-in-the-cox-regression-model.html#deviance-residuals"><i class="fa fa-check"></i><b>4.4.1</b> Deviance residuals</a></li>
<li class="chapter" data-level="4.4.2" data-path="model-checking-in-the-cox-regression-model.html"><a href="model-checking-in-the-cox-regression-model.html#dfbeta"><i class="fa fa-check"></i><b>4.4.2</b> dfbeta</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="parametric-proportional-hazards-models.html"><a href="parametric-proportional-hazards-models.html"><i class="fa fa-check"></i><b>5</b> Parametric Proportional Hazards Models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="parametric-proportional-hazards-models.html"><a href="parametric-proportional-hazards-models.html#introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="parametric-proportional-hazards-models.html"><a href="parametric-proportional-hazards-models.html#exponential-survival-function-for-the-survival-time"><i class="fa fa-check"></i><b>5.2</b> Exponential survival function for the survival time</a></li>
<li class="chapter" data-level="5.3" data-path="parametric-proportional-hazards-models.html"><a href="parametric-proportional-hazards-models.html#the-weibull-survival-function"><i class="fa fa-check"></i><b>5.3</b> The Weibull survival function</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="parametric-proportional-hazards-models.html"><a href="parametric-proportional-hazards-models.html#proportional-hazards-representation---ph"><i class="fa fa-check"></i><b>5.3.1</b> Proportional hazards representation - PH</a></li>
<li class="chapter" data-level="5.3.2" data-path="parametric-proportional-hazards-models.html"><a href="parametric-proportional-hazards-models.html#the-accelerated-failure-time-representation---aft"><i class="fa fa-check"></i><b>5.3.2</b> The accelerated failure time representation - AFT</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="parametric-proportional-hazards-models.html"><a href="parametric-proportional-hazards-models.html#estimating-the-hazard-function-and-survival"><i class="fa fa-check"></i><b>5.4</b> Estimating the hazard function and survival</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="parametric-proportional-hazards-models.html"><a href="parametric-proportional-hazards-models.html#exponential-with-flexsurv"><i class="fa fa-check"></i><b>5.4.1</b> Exponential with flexsurv</a></li>
<li class="chapter" data-level="5.4.2" data-path="parametric-proportional-hazards-models.html"><a href="parametric-proportional-hazards-models.html#weibull-ph-with-flexsurv"><i class="fa fa-check"></i><b>5.4.2</b> Weibull PH with flexsurv</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="parametric-proportional-hazards-models.html"><a href="parametric-proportional-hazards-models.html#covariates-and-hazard-ratios"><i class="fa fa-check"></i><b>5.5</b> Covariates and Hazard ratios</a></li>
<li class="chapter" data-level="5.6" data-path="parametric-proportional-hazards-models.html"><a href="parametric-proportional-hazards-models.html#test-of-interaction-using-flexurvreg"><i class="fa fa-check"></i><b>5.6</b> Test of interaction using flexurvreg</a></li>
<li class="chapter" data-level="5.7" data-path="parametric-proportional-hazards-models.html"><a href="parametric-proportional-hazards-models.html#comparison-with-a-cox-model"><i class="fa fa-check"></i><b>5.7</b> Comparison with a Cox model</a></li>
<li class="chapter" data-level="5.8" data-path="parametric-proportional-hazards-models.html"><a href="parametric-proportional-hazards-models.html#estimating-risk"><i class="fa fa-check"></i><b>5.8</b> Estimating risk</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="time-dependent-variables-and-covariates.html"><a href="time-dependent-variables-and-covariates.html"><i class="fa fa-check"></i><b>6</b> Time-Dependent Variables and Covariates</a></li>
<li class="chapter" data-level="7" data-path="competing-risks.html"><a href="competing-risks.html"><i class="fa fa-check"></i><b>7</b> Competing Risks</a></li>
<li class="divider"></li>
<li><a href="https://github.com/bgautijonsson/survivalanalysis" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Survival Analysis (LÝÐ079F)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="parametric-proportional-hazards-models" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Parametric Proportional Hazards Models</h1>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="parametric-proportional-hazards-models.html#cb160-1"></a><span class="kw">library</span>(muhaz)</span>
<span id="cb160-2"><a href="parametric-proportional-hazards-models.html#cb160-2"></a><span class="kw">library</span>(flexsurv)</span>
<span id="cb160-3"><a href="parametric-proportional-hazards-models.html#cb160-3"></a><span class="kw">library</span>(eha)</span>
<span id="cb160-4"><a href="parametric-proportional-hazards-models.html#cb160-4"></a><span class="kw">library</span>(mice) <span class="co"># for Nelson Aalen</span></span>
<span id="cb160-5"><a href="parametric-proportional-hazards-models.html#cb160-5"></a><span class="kw">library</span>(epitools)</span>
<span id="cb160-6"><a href="parametric-proportional-hazards-models.html#cb160-6"></a><span class="kw">library</span>(rms)</span>
<span id="cb160-7"><a href="parametric-proportional-hazards-models.html#cb160-7"></a><span class="kw">library</span>(bshazard)</span></code></pre></div>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="parametric-proportional-hazards-models.html#cb161-1"></a>knitr<span class="op">::</span><span class="kw">include_app</span>(<span class="st">&quot;https://bgautijonsson.shinyapps.io/ParametricModels/&quot;</span>, <span class="dt">height =</span> <span class="st">&quot;800px&quot;</span>)</span></code></pre></div>
<iframe src="https://bgautijonsson.shinyapps.io/ParametricModels/?showcase=0" width="100%" height="800px">
</iframe>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="parametric-proportional-hazards-models.html#cb162-1"></a><span class="kw">data</span>(<span class="st">&quot;wcgs&quot;</span>)</span>
<span id="cb162-2"><a href="parametric-proportional-hazards-models.html#cb162-2"></a>wcgs<span class="op">$</span>age0q5 &lt;-<span class="st"> </span><span class="kw">cut</span>(wcgs<span class="op">$</span>age0,<span class="dt">breaks=</span><span class="kw">quantile</span>(wcgs<span class="op">$</span>age0,<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>)),<span class="dt">include.lowest=</span>T,<span class="dt">right=</span><span class="ot">FALSE</span>)</span>
<span id="cb162-3"><a href="parametric-proportional-hazards-models.html#cb162-3"></a>wcgs<span class="op">$</span>behpat0f &lt;-<span class="st"> </span><span class="kw">factor</span>(wcgs<span class="op">$</span>behpat0,<span class="dt">levels=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,<span class="dt">label=</span><span class="kw">c</span>(<span class="st">&quot;A1&quot;</span>,<span class="st">&quot;A2&quot;</span>,<span class="st">&quot;B1&quot;</span>,<span class="st">&quot;B2&quot;</span>))</span>
<span id="cb162-4"><a href="parametric-proportional-hazards-models.html#cb162-4"></a>wcgs<span class="op">$</span>dibpat0f &lt;-<span class="st"> </span><span class="kw">factor</span>(wcgs<span class="op">$</span>dibpat0,<span class="dt">levels=</span><span class="dv">0</span><span class="op">:</span><span class="dv">1</span>,<span class="dt">label=</span><span class="kw">c</span>(<span class="st">&quot;B&quot;</span>,<span class="st">&quot;A&quot;</span>))</span>
<span id="cb162-5"><a href="parametric-proportional-hazards-models.html#cb162-5"></a>wcgs<span class="op">$</span>smoker &lt;-<span class="st"> </span><span class="kw">ifelse</span>(wcgs<span class="op">$</span>ncigs0<span class="op">&gt;</span><span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</span>
<span id="cb162-6"><a href="parametric-proportional-hazards-models.html#cb162-6"></a>wcgs<span class="op">$</span>smokerf &lt;-<span class="st"> </span><span class="kw">factor</span>(wcgs<span class="op">$</span>smoker,<span class="dt">levels=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>),<span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;Yes&quot;</span>,<span class="st">&quot;No&quot;</span>))</span>
<span id="cb162-7"><a href="parametric-proportional-hazards-models.html#cb162-7"></a>wcgs<span class="op">$</span>smokerfny &lt;-<span class="st"> </span><span class="kw">factor</span>(wcgs<span class="op">$</span>smoker,<span class="dt">levels=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>))</span>
<span id="cb162-8"><a href="parametric-proportional-hazards-models.html#cb162-8"></a>wcgs<span class="op">$</span>heightcm &lt;-<span class="st"> </span>wcgs<span class="op">$</span>height0<span class="op">*</span><span class="fl">2.54</span></span>
<span id="cb162-9"><a href="parametric-proportional-hazards-models.html#cb162-9"></a>wcgs<span class="op">$</span>weightkg &lt;-<span class="st"> </span>wcgs<span class="op">$</span>weight0<span class="op">*</span><span class="fl">0.45359237</span></span>
<span id="cb162-10"><a href="parametric-proportional-hazards-models.html#cb162-10"></a>wcgs<span class="op">$</span>bmi &lt;-<span class="st"> </span>wcgs<span class="op">$</span>weightkg <span class="op">/</span><span class="st"> </span>(wcgs<span class="op">$</span>heightcm<span class="op">/</span><span class="dv">100</span>)<span class="op">^</span><span class="dv">2</span></span>
<span id="cb162-11"><a href="parametric-proportional-hazards-models.html#cb162-11"></a>wcgs<span class="op">$</span>cholmmol =<span class="st"> </span>wcgs<span class="op">$</span>chol<span class="op">/</span><span class="dv">39</span></span>
<span id="cb162-12"><a href="parametric-proportional-hazards-models.html#cb162-12"></a>wcgs<span class="op">$</span>chd69f &lt;-<span class="st"> </span><span class="kw">factor</span>(wcgs<span class="op">$</span>chd69,<span class="dt">levels=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>),<span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;Yes&quot;</span>,<span class="st">&quot;No&quot;</span>))</span>
<span id="cb162-13"><a href="parametric-proportional-hazards-models.html#cb162-13"></a>wcgs<span class="op">$</span>chd69fny &lt;-<span class="st"> </span><span class="kw">factor</span>(wcgs<span class="op">$</span>chd69,<span class="dt">levels=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),<span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;No CHD&quot;</span>,<span class="st">&quot;CHD&quot;</span>))</span>
<span id="cb162-14"><a href="parametric-proportional-hazards-models.html#cb162-14"></a>wcgs<span class="op">$</span>bmiq5 &lt;-<span class="st"> </span><span class="kw">cut</span>(wcgs<span class="op">$</span>bmi,<span class="dt">breaks=</span><span class="kw">quantile</span>(wcgs<span class="op">$</span>bmi,<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="fl">0.2</span>)),<span class="dt">include.lowest=</span>T,<span class="dt">right=</span><span class="ot">FALSE</span>)</span>
<span id="cb162-15"><a href="parametric-proportional-hazards-models.html#cb162-15"></a>wcgs<span class="op">$</span>time169y &lt;-<span class="st"> </span>wcgs<span class="op">$</span>time169<span class="op">/</span><span class="fl">365.24</span></span>
<span id="cb162-16"><a href="parametric-proportional-hazards-models.html#cb162-16"></a><span class="co"># restricted followup to 5 years</span></span>
<span id="cb162-17"><a href="parametric-proportional-hazards-models.html#cb162-17"></a>wcgs<span class="op">$</span>time169y5 &lt;-<span class="st"> </span><span class="kw">pmin</span>(wcgs<span class="op">$</span>time169y,<span class="dv">5</span>)</span>
<span id="cb162-18"><a href="parametric-proportional-hazards-models.html#cb162-18"></a>wcgs<span class="op">$</span>chd695 &lt;-<span class="st"> </span>(wcgs<span class="op">$</span>chd69<span class="op">==</span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>wcgs<span class="op">$</span>time169y <span class="op">&lt;=</span><span class="dv">5</span>)</span>
<span id="cb162-19"><a href="parametric-proportional-hazards-models.html#cb162-19"></a></span>
<span id="cb162-20"><a href="parametric-proportional-hazards-models.html#cb162-20"></a>wcgs<span class="op">$</span>agec &lt;-<span class="st"> </span>wcgs<span class="op">$</span>age0 <span class="op">-</span><span class="st"> </span><span class="dv">46</span></span>
<span id="cb162-21"><a href="parametric-proportional-hazards-models.html#cb162-21"></a>wcgs<span class="op">$</span>cholmmolc &lt;-<span class="st"> </span>wcgs<span class="op">$</span>cholmmol <span class="op">-</span><span class="st"> </span><span class="fl">5.8</span></span>
<span id="cb162-22"><a href="parametric-proportional-hazards-models.html#cb162-22"></a>wcgs<span class="op">$</span>sbpc &lt;-<span class="st"> </span>wcgs<span class="op">$</span>sbp0 <span class="op">-</span><span class="st"> </span><span class="dv">128</span></span></code></pre></div>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">5.1</span> Introduction</h2>
<p>We continue to use the <em>wcgs</em> data included with the <em>epitools</em> package. WCGS stands for the Western Collaborative Group Study.</p>
<p>If the rate of events follow a Poisson distribution it can be shown that the time between events, or the time until next event, follow an <em>exponential distribution</em>.</p>
<p>Overall incidence or hazard rate in the WCGS data was</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="parametric-proportional-hazards-models.html#cb163-1"></a>fut &lt;-<span class="st"> </span><span class="kw">sum</span>(wcgs<span class="op">$</span>time169y)</span>
<span id="cb163-2"><a href="parametric-proportional-hazards-models.html#cb163-2"></a>en &lt;-<span class="st"> </span><span class="kw">sum</span>(wcgs<span class="op">$</span>chd69)</span>
<span id="cb163-3"><a href="parametric-proportional-hazards-models.html#cb163-3"></a>fut</span></code></pre></div>
<pre><code>## [1] 23176.25</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="parametric-proportional-hazards-models.html#cb165-1"></a>en</span></code></pre></div>
<pre><code>## [1] 257</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="parametric-proportional-hazards-models.html#cb167-1"></a>en<span class="op">/</span>fut</span></code></pre></div>
<pre><code>## [1] 0.01108894</code></pre>
<p>For every 1000 person years:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="parametric-proportional-hazards-models.html#cb169-1"></a>en<span class="op">/</span>fut<span class="op">*</span><span class="dv">1000</span></span></code></pre></div>
<pre><code>## [1] 11.08894</code></pre>
<p>The incidence can also be estimated from the Poisson model using an <em>offset</em>. The term offset means that we standardize the number of outcomes by the time. We use log of time because the Poisson model has a log-link.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="parametric-proportional-hazards-models.html#cb171-1"></a>fit0 &lt;-<span class="st"> </span><span class="kw">glm</span>(chd69 <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">offset</span>(<span class="kw">log</span>(time169y)),<span class="dt">family=</span><span class="kw">poisson</span>(),<span class="dt">data=</span>wcgs)</span>
<span id="cb171-2"><a href="parametric-proportional-hazards-models.html#cb171-2"></a><span class="kw">exp</span>(<span class="kw">coef</span>(fit0))<span class="op">*</span><span class="dv">1000</span></span></code></pre></div>
<pre><code>## (Intercept) 
##    11.08894</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="parametric-proportional-hazards-models.html#cb173-1"></a><span class="kw">exp</span>(<span class="kw">confint.default</span>(fit0))<span class="op">*</span><span class="dv">1000</span></span></code></pre></div>
<pre><code>##                2.5 %   97.5 %
## (Intercept) 9.812822 12.53101</code></pre>
<p>The cumulative incidence is then simply <span class="math inline">\(\lambda t\)</span> after observation length <span class="math inline">\(T=t\)</span>. This is an assumption that needs further inspection.</p>
</div>
<div id="exponential-survival-function-for-the-survival-time" class="section level2">
<h2><span class="header-section-number">5.2</span> Exponential survival function for the survival time</h2>
<p>We’ll begin by plotting the hazard function, which is the rate of events over a small time interval. Given that time <span class="math inline">\(t\)</span> has passed, the probability an event will take place at time <span class="math inline">\(T\)</span> in the interval between <span class="math inline">\(t\)</span> and <span class="math inline">\(t+\delta\)</span> is P[t T &lt; t + |T t].</p>
<p>The hazard rate is this probability standardized by a small time interval, and then we get a rate when the interval goes to zero length:
<span class="math display">\[
h(t) = \frac{P[t \le T &lt; t + \delta|T \ge t]}{\delta}.
\]</span></p>
<p>Note that <span class="math inline">\(h() \ge 0\)</span>.</p>
<p>The connection between the exponential distribution and the Poisson model is that if the Poisson model holds then the exponential model holds for the time and the hazard is constant:
<span class="math display">\[
h(t) = \lambda
\]</span></p>
<p>We’ll estimate the <em>hazard</em> using the <em>muhaz</em> function in <em>R</em>. The rate from the Poisson model, assuming constant hazard, is superimposed.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="parametric-proportional-hazards-models.html#cb175-1"></a>fitm &lt;-<span class="st"> </span><span class="kw">bshazard</span>(<span class="kw">Surv</span>(time169y,chd69)<span class="op">~</span><span class="dv">1</span>,<span class="dt">data=</span>wcgs)</span></code></pre></div>
<pre><code>## Iterations: relative error in phi-hat = 1e-04 
## phi= 1.400538   sv2= 0.03443796   df= 10.75369   lambda= 40.66844 
## phi= 1.428413   sv2= 0.008229519   df= 7.815714   lambda= 173.5718 
## phi= 1.462473   sv2= 0.002951656   df= 5.667443   lambda= 495.4755 
## phi= 1.493406   sv2= 0.001583692   df= 4.551427   lambda= 942.9903 
## phi= 1.514479   sv2= 0.001057151   df= 4.007546   lambda= 1432.604 
## phi= 1.52876   sv2= 0.0007761689   df= 3.701527   lambda= 1969.622 
## phi= 1.539557   sv2= 0.00059308   df= 3.490586   lambda= 2595.868 
## phi= 1.548565   sv2= 0.0004582588   df= 3.321545   lambda= 3379.238 
## phi= 1.556631   sv2= 0.0003512205   df= 3.171027   lambda= 4432.063 
## phi= 1.564196   sv2= 0.0002626861   df= 3.026499   lambda= 5954.622 
## phi= 1.571455   sv2= 0.0001886837   df= 2.88026   lambda= 8328.516 
## phi= 1.578402   sv2= 0.0001280916   df= 2.727957   lambda= 12322.45</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="parametric-proportional-hazards-models.html#cb177-1"></a>haz.frame &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span>fitm<span class="op">$</span>time,<span class="dt">y=</span>fitm<span class="op">$</span>hazard)</span>
<span id="cb177-2"><a href="parametric-proportional-hazards-models.html#cb177-2"></a><span class="kw">ggplot</span>(haz.frame,<span class="kw">aes</span>(x,y))<span class="op">+</span><span class="kw">geom_line</span>()<span class="op">+</span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">exp</span>(<span class="kw">coef</span>(fit0)),<span class="dt">lty=</span><span class="dv">2</span>)<span class="op">+</span></span>
<span id="cb177-3"><a href="parametric-proportional-hazards-models.html#cb177-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;t (years)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;h(t)&quot;</span>)</span></code></pre></div>
<p><img src="Survival_Analysis_files/figure-html/unnamed-chunk-103-1.png" width="100%" /></p>
<p>It seems that the rate is increasing along with the duration of the follow up. The cohort is getting older as time passes and there is no renewal of younger men into the cohort.</p>
<p>The survival function for an exponential distribution is
<span class="math display">\[
S(t) = P[T&gt;t] = \exp(-\lambda t).
\]</span></p>
<p>The cumulative hazard function <span class="math inline">\(H\)</span> is the integral of the hazard function or
<span class="math display">\[
H(t) = \int_0^t h(u) du =  \int_0^t \lambda \, du = \lambda t.
\]</span></p>
<p>Note that a general result from survival analysis says that
<span class="math display">\[
S(t) = \exp(-H(t))
\]</span></p>
<p>The <em>flexsurv</em> package can be used to get an estimate for <span class="math inline">\(\lambda\)</span> for the exponential distribution. Note that there are <strong>two</strong> different ways to present the exponential and the Weibull distributions in survival analysis. Either using the proportional hazards (PH) definition or the accelerated failure time (AFT) definition. We’ll consider the PH approach. It is possible to compute estimates from one approach to the other.</p>
<p>Recall the proportional hazards model:
<span class="math display">\[
h(t) = h_0(t) \exp(\beta_1 x_1 + \cdots + \beta_p x_p)
\]</span>
Equivalently
<span class="math display">\[
\log h(t) = \log h_0(t) + \beta_1 x_1 + \cdots + \beta_p x_p
\]</span></p>
<p>Here <span class="math inline">\(x_1,\ldots,x_p\)</span> are covariates.</p>
<p>Applying <em>flexsurvreg</em>, assuming the exponential distribution, with no covariates gives</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="parametric-proportional-hazards-models.html#cb178-1"></a>fit.e.ph  &lt;-<span class="st"> </span><span class="kw">flexsurvreg</span>(<span class="kw">Surv</span>(time169y,chd69)<span class="op">~</span><span class="dv">1</span>,<span class="dt">dist=</span><span class="st">&quot;exponential&quot;</span>,</span>
<span id="cb178-2"><a href="parametric-proportional-hazards-models.html#cb178-2"></a>                         <span class="dt">data=</span>wcgs)</span>
<span id="cb178-3"><a href="parametric-proportional-hazards-models.html#cb178-3"></a>fit.e.ph</span></code></pre></div>
<pre><code>## Call:
## flexsurvreg(formula = Surv(time169y, chd69) ~ 1, data = wcgs, 
##     dist = &quot;exponential&quot;)
## 
## Estimates: 
##       est       L95%      U95%      se      
## rate  0.011089  0.009813  0.012531  0.000692
## 
## N = 3154,  Events: 257,  Censored: 2897
## Total time at risk: 23176.25
## Log-likelihood = -1413.964, df = 1
## AIC = 2829.929</code></pre>
<p>We recognize the estimate of <span class="math inline">\(\lambda\)</span>. However, if we apply the coef() function we get</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="parametric-proportional-hazards-models.html#cb180-1"></a><span class="kw">coef</span>(fit.e.ph)</span></code></pre></div>
<pre><code>## [1] -4.501807</code></pre>
<p>and this is <span class="math inline">\(\log(\lambda)\)</span> or <span class="math inline">\(\lambda=\exp(-4.501807)\)</span>.</p>
<p>The fact that
<span class="math display">\[
S(t) = \exp(-H(t))
\]</span>
shows that it is more natural to model the hazard or the cumulative hazard, and then estimate the survival. The cumulative hazard function should be in the focus during the modeling process. The survival function is then a by product. This is the approach taken when using the non-parametric Nelson-Aalen estimator of survival.First the cumulative hazard is estimated and then the survival.</p>
<p>Let’s compare the non-parametric Nelson - Aalen estimate of the cumulative survival to the parametric exponential estimate.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="parametric-proportional-hazards-models.html#cb182-1"></a>nelson.aalen.e.fit &lt;-<span class="st"> </span><span class="kw">nelsonaalen</span>(wcgs,time169y,chd69)</span>
<span id="cb182-2"><a href="parametric-proportional-hazards-models.html#cb182-2"></a>na.e.frame &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">time=</span>wcgs<span class="op">$</span>time169y,<span class="dt">H.na=</span>nelson.aalen.e.fit,</span>
<span id="cb182-3"><a href="parametric-proportional-hazards-models.html#cb182-3"></a>                         <span class="dt">H.e =</span> <span class="kw">exp</span>(<span class="kw">coef</span>(fit.e.ph))<span class="op">*</span>wcgs<span class="op">$</span>time169y)</span>
<span id="cb182-4"><a href="parametric-proportional-hazards-models.html#cb182-4"></a></span>
<span id="cb182-5"><a href="parametric-proportional-hazards-models.html#cb182-5"></a><span class="kw">ggplot</span>(na.e.frame,<span class="kw">aes</span>(<span class="dt">x=</span>time))<span class="op">+</span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>H.na,<span class="dt">colour=</span><span class="st">&quot;blue&quot;</span>))<span class="op">+</span></span>
<span id="cb182-6"><a href="parametric-proportional-hazards-models.html#cb182-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>H.e,<span class="dt">colour=</span><span class="st">&quot;green&quot;</span>)) <span class="op">+</span></span>
<span id="cb182-7"><a href="parametric-proportional-hazards-models.html#cb182-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Time (t)&quot;</span>) <span class="op">+</span></span>
<span id="cb182-8"><a href="parametric-proportional-hazards-models.html#cb182-8"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Cumulative Hazard H(t)&quot;</span>) <span class="op">+</span></span>
<span id="cb182-9"><a href="parametric-proportional-hazards-models.html#cb182-9"></a><span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="st">&quot;Estimate&quot;</span>,<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;green&quot;</span>),<span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;N-Aalen&quot;</span>,<span class="st">&quot;Exponential&quot;</span>))</span></code></pre></div>
<p><img src="Survival_Analysis_files/figure-html/unnamed-chunk-106-1.png" width="100%" /></p>
<p>For completeness we also compare the survival curves based on the Nelson-Aalen estimate (<span class="math inline">\(S(t)=exp(-H(t)\)</span>), the Kaplan Meier estimate, and the exponential estimate (<span class="math inline">\(S(t)=exp(-\lambda t)\)</span>).</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="parametric-proportional-hazards-models.html#cb183-1"></a>kmfit &lt;-<span class="st"> </span><span class="kw">survfit</span>(<span class="kw">Surv</span>(time169y,chd69)<span class="op">~</span><span class="dv">1</span>,<span class="dt">data=</span>wcgs)</span>
<span id="cb183-2"><a href="parametric-proportional-hazards-models.html#cb183-2"></a>km.frame &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">summary</span>(kmfit)[<span class="dv">2</span><span class="op">:</span><span class="dv">10</span>])</span>
<span id="cb183-3"><a href="parametric-proportional-hazards-models.html#cb183-3"></a></span>
<span id="cb183-4"><a href="parametric-proportional-hazards-models.html#cb183-4"></a><span class="kw">ggplot</span>(na.e.frame,<span class="kw">aes</span>(<span class="dt">x=</span>time))<span class="op">+</span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span><span class="kw">exp</span>(<span class="op">-</span>H.na),<span class="dt">colour=</span><span class="st">&quot;blue&quot;</span>)) <span class="op">+</span></span>
<span id="cb183-5"><a href="parametric-proportional-hazards-models.html#cb183-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span><span class="kw">exp</span>(<span class="op">-</span>H.e),<span class="dt">colour=</span><span class="st">&quot;green&quot;</span>)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_step</span>(<span class="dt">data=</span>km.frame,<span class="kw">aes</span>(time,surv,<span class="dt">color=</span><span class="st">&quot;red&quot;</span>),<span class="dt">lty=</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb183-6"><a href="parametric-proportional-hazards-models.html#cb183-6"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Time (t)&quot;</span>) <span class="op">+</span></span>
<span id="cb183-7"><a href="parametric-proportional-hazards-models.html#cb183-7"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Survival S(t)&quot;</span>) <span class="op">+</span></span>
<span id="cb183-8"><a href="parametric-proportional-hazards-models.html#cb183-8"></a><span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="st">&quot;Estimate&quot;</span>,<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;red&quot;</span>),<span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;N-Aalen&quot;</span>,<span class="st">&quot;Exponential&quot;</span>,<span class="st">&quot;K-M&quot;</span>))</span></code></pre></div>
<p><img src="Survival_Analysis_files/figure-html/unnamed-chunk-107-1.png" width="100%" /></p>
</div>
<div id="the-weibull-survival-function" class="section level2">
<h2><span class="header-section-number">5.3</span> The Weibull survival function</h2>
<div id="proportional-hazards-representation---ph" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Proportional hazards representation - PH</h3>
<p>A more flexible function for the hazard is based on the <em>Weibull</em> distribution. The hazard is then a non-constant function of time and has the form:</p>
<p><span class="math display">\[
h(t) = \mu \alpha t ^ {\alpha - 1}
\]</span>
The cumulative hazard is then</p>
<p><span class="math display">\[
H(t) = \mu  t ^ {\alpha }
\]</span>
and the survival
<span class="math display">\[
S(t)=\exp(-H(t))=\exp(- \mu t ^ \alpha)
\]</span>
Note that <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\alpha\)</span> are parameters and <span class="math inline">\(t\)</span> stands for time. We refer to <span class="math inline">\(\alpha\)</span> as the the shape and <span class="math inline">\(\mu\)</span> as the scale. Note that when <span class="math inline">\(\alpha=1\)</span> we have the exponential distribution.</p>
<p>Please note that the parametric form differs between textbooks and statistical programs and even between packages within R. Read the help files carefully!</p>
</div>
<div id="the-accelerated-failure-time-representation---aft" class="section level3">
<h3><span class="header-section-number">5.3.2</span> The accelerated failure time representation - AFT</h3>
<p>In <strong>R</strong> the convention is to use the same form as for the Weibull distribution functions, <em>dweibull</em> etc. This is called the
the accelerated failure time (AFT) representation.</p>
<p>The cumulative hazard is:
<span class="math display">\[
H(t) = (t/b)^a = \frac{1}{b^a} t ^ a
\]</span></p>
<p>and the hazard is</p>
<p><span class="math display">\[
h(t) = \frac{a}{b^a} t ^ {a-1}
\]</span>
Note that <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are parameters and <span class="math inline">\(t\)</span> stands for time.</p>
<p>The parameters in <em>R</em> (and other programs) have special names:</p>
<ul>
<li><span class="math inline">\(a\)</span> is called <em>shape</em></li>
<li><span class="math inline">\(b\)</span> is called <em>scale</em></li>
</ul>
<p>Note that <span class="math inline">\(b\)</span> <em>scales</em> the time and <span class="math inline">\(a\)</span> controls the <em>shape</em>.</p>
<p>The role of the shape is similar for the PH and AFT representations.</p>
<p>Let’s try plotting the hazard and cumulative hazard for a given set of <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> in <em>R</em>. You can experiment by changing the values for <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> and study how the functional form changes. Note that we use <span class="math inline">\(x\)</span> instead of <span class="math inline">\(t\)</span> inside the function because <span class="math inline">\(t\)</span> is reserved in R. The cumulative hazard function corresponding is below the corresponding hazard function.</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="parametric-proportional-hazards-models.html#cb184-1"></a>a&lt;-<span class="dv">1</span></span>
<span id="cb184-2"><a href="parametric-proportional-hazards-models.html#cb184-2"></a>b&lt;-<span class="dv">2</span></span>
<span id="cb184-3"><a href="parametric-proportional-hazards-models.html#cb184-3"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="fl">0.1</span>,<span class="dv">10</span>,<span class="fl">0.1</span>)</span>
<span id="cb184-4"><a href="parametric-proportional-hazards-models.html#cb184-4"></a>h &lt;-<span class="st"> </span><span class="cf">function</span>(x) {a<span class="op">/</span>b<span class="op">^</span>a <span class="op">*</span><span class="st"> </span>x <span class="op">^</span><span class="st"> </span>(a<span class="dv">-1</span>)}</span>
<span id="cb184-5"><a href="parametric-proportional-hazards-models.html#cb184-5"></a>H &lt;-<span class="st"> </span><span class="cf">function</span>(x) {(x<span class="op">/</span>b)<span class="op">^</span>a}</span>
<span id="cb184-6"><a href="parametric-proportional-hazards-models.html#cb184-6"></a></span>
<span id="cb184-7"><a href="parametric-proportional-hazards-models.html#cb184-7"></a><span class="kw">par</span>(<span class="dt">mfcol=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb184-8"><a href="parametric-proportional-hazards-models.html#cb184-8"></a><span class="kw">plot</span>(x,<span class="kw">h</span>(x),<span class="dt">type=</span><span class="st">&quot;l&quot;</span>,<span class="dt">xlab=</span><span class="st">&quot;t&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;h(t)=a/b^a * t ^ (a-1)&quot;</span>)</span>
<span id="cb184-9"><a href="parametric-proportional-hazards-models.html#cb184-9"></a><span class="kw">text</span>(<span class="dv">6</span>,<span class="kw">jitter</span>(<span class="kw">mean</span>(<span class="kw">h</span>(x))),<span class="dt">labels=</span><span class="kw">paste</span>(<span class="st">&quot;a =&quot;</span>,a,<span class="st">&quot; b =&quot;</span>,b))</span>
<span id="cb184-10"><a href="parametric-proportional-hazards-models.html#cb184-10"></a><span class="kw">plot</span>(x,<span class="kw">H</span>(x),<span class="dt">type=</span><span class="st">&quot;l&quot;</span>,<span class="dt">xlab=</span><span class="st">&quot;t&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;H(t)=1/b^a * t ^ a&quot;</span>)</span>
<span id="cb184-11"><a href="parametric-proportional-hazards-models.html#cb184-11"></a><span class="kw">text</span>(<span class="dv">6</span>,<span class="kw">jitter</span>(<span class="kw">mean</span>(<span class="kw">H</span>(x))),<span class="dt">labels=</span><span class="kw">paste</span>(<span class="st">&quot;a =&quot;</span>,a,<span class="st">&quot; b =&quot;</span>,b))</span>
<span id="cb184-12"><a href="parametric-proportional-hazards-models.html#cb184-12"></a>a &lt;-<span class="st"> </span><span class="fl">0.5</span></span>
<span id="cb184-13"><a href="parametric-proportional-hazards-models.html#cb184-13"></a>b &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb184-14"><a href="parametric-proportional-hazards-models.html#cb184-14"></a><span class="kw">plot</span>(x,<span class="kw">h</span>(x),<span class="dt">type=</span><span class="st">&quot;l&quot;</span>,<span class="dt">xlab=</span><span class="st">&quot;t&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;h(t)=a/b^a * t ^ (a-1)&quot;</span>)</span>
<span id="cb184-15"><a href="parametric-proportional-hazards-models.html#cb184-15"></a><span class="kw">text</span>(<span class="dv">6</span>,<span class="kw">jitter</span>(<span class="kw">mean</span>(<span class="kw">h</span>(x))),<span class="dt">labels=</span><span class="kw">paste</span>(<span class="st">&quot;a =&quot;</span>,a,<span class="st">&quot; b =&quot;</span>,b))</span>
<span id="cb184-16"><a href="parametric-proportional-hazards-models.html#cb184-16"></a><span class="kw">plot</span>(x,<span class="kw">H</span>(x),<span class="dt">type=</span><span class="st">&quot;l&quot;</span>,<span class="dt">xlab=</span><span class="st">&quot;t&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;H(t)=1/b^a * t ^ a&quot;</span>)</span>
<span id="cb184-17"><a href="parametric-proportional-hazards-models.html#cb184-17"></a><span class="kw">text</span>(<span class="dv">6</span>,<span class="kw">jitter</span>(<span class="kw">mean</span>(<span class="kw">H</span>(x))),<span class="dt">labels=</span><span class="kw">paste</span>(<span class="st">&quot;a =&quot;</span>,a,<span class="st">&quot; b =&quot;</span>,b))</span></code></pre></div>
<p><img src="Survival_Analysis_files/figure-html/unnamed-chunk-108-1.png" width="100%" /></p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="parametric-proportional-hazards-models.html#cb185-1"></a><span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
</div>
</div>
<div id="estimating-the-hazard-function-and-survival" class="section level2">
<h2><span class="header-section-number">5.4</span> Estimating the hazard function and survival</h2>
<div id="exponential-with-flexsurv" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Exponential with flexsurv</h3>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="parametric-proportional-hazards-models.html#cb186-1"></a>fit.e.ph  &lt;-<span class="st"> </span><span class="kw">flexsurvreg</span>(<span class="kw">Surv</span>(time169y,chd69)<span class="op">~</span><span class="dv">1</span>,<span class="dt">data=</span>wcgs,<span class="dt">dist=</span><span class="st">&quot;exponential&quot;</span>)</span>
<span id="cb186-2"><a href="parametric-proportional-hazards-models.html#cb186-2"></a>fit.e.ph</span></code></pre></div>
<pre><code>## Call:
## flexsurvreg(formula = Surv(time169y, chd69) ~ 1, data = wcgs, 
##     dist = &quot;exponential&quot;)
## 
## Estimates: 
##       est       L95%      U95%      se      
## rate  0.011089  0.009813  0.012531  0.000692
## 
## N = 3154,  Events: 257,  Censored: 2897
## Total time at risk: 23176.25
## Log-likelihood = -1413.964, df = 1
## AIC = 2829.929</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="parametric-proportional-hazards-models.html#cb188-1"></a><span class="kw">coef</span>(fit.e.ph)</span></code></pre></div>
<pre><code>## [1] -4.501807</code></pre>
</div>
<div id="weibull-ph-with-flexsurv" class="section level3">
<h3><span class="header-section-number">5.4.2</span> Weibull PH with flexsurv</h3>
<p>We’ll use <em>flexsurvreg</em> to estimate <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\alpha\)</span> for the <em>wcgs</em> data. Note the use of dist=“weibullph”.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="parametric-proportional-hazards-models.html#cb190-1"></a>fit.w.ph  &lt;-<span class="st"> </span><span class="kw">flexsurvreg</span>(<span class="kw">Surv</span>(time169y,chd69)<span class="op">~</span><span class="dv">1</span>,<span class="dt">data=</span>wcgs,<span class="dt">dist=</span><span class="st">&quot;weibullph&quot;</span>)</span>
<span id="cb190-2"><a href="parametric-proportional-hazards-models.html#cb190-2"></a>fit.w.ph</span></code></pre></div>
<pre><code>## Call:
## flexsurvreg(formula = Surv(time169y, chd69) ~ 1, data = wcgs, 
##     dist = &quot;weibullph&quot;)
## 
## Estimates: 
##        est      L95%     U95%     se     
## shape  1.29985  1.15471  1.46324  0.07853
## scale  0.00601  0.00429  0.00843  0.00104
## 
## N = 3154,  Events: 257,  Censored: 2897
## Total time at risk: 23176.25
## Log-likelihood = -1405.351, df = 2
## AIC = 2814.703</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="parametric-proportional-hazards-models.html#cb192-1"></a><span class="kw">coef</span>(fit.w.ph)</span></code></pre></div>
<pre><code>##      shape      scale 
##  0.2622523 -5.1140774</code></pre>
<p>This means that
<span class="math display">\[
H(t) = H_0(t) = \exp(-5.1141) t ^ {\exp(0.2622523)}
\]</span></p>
<p>Here we write <span class="math inline">\(\mu=\exp(\beta_0)\)</span> where <span class="math inline">\(\beta_0\)</span> is the log-scale from the <em>flexsurv</em> model.</p>
<p>Let’s draw the <span class="math inline">\(h()\)</span> from the exponential estimate (broken line) and the Weibull estimate (blue line). We use <span class="math inline">\(x\)</span> for time because <span class="math inline">\(t\)</span> is a reserved function in <em>R</em>. R computes for for each value in <span class="math inline">\(x\)</span> the value of <span class="math inline">\(h(x)\)</span> where we take <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\alpha\)</span> from the estimation above.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="parametric-proportional-hazards-models.html#cb194-1"></a><span class="kw">plot</span>(fitm,<span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.03</span>))</span>
<span id="cb194-2"><a href="parametric-proportional-hazards-models.html#cb194-2"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">9</span>,<span class="fl">0.1</span>)</span>
<span id="cb194-3"><a href="parametric-proportional-hazards-models.html#cb194-3"></a>alpha&lt;-<span class="kw">exp</span>(<span class="kw">coef</span>(fit.w.ph)[<span class="dv">1</span>])</span>
<span id="cb194-4"><a href="parametric-proportional-hazards-models.html#cb194-4"></a>mu&lt;-<span class="kw">exp</span>(<span class="kw">coef</span>(fit.w.ph)[<span class="dv">2</span>])</span>
<span id="cb194-5"><a href="parametric-proportional-hazards-models.html#cb194-5"></a>h &lt;-<span class="st"> </span><span class="cf">function</span>(x) {mu<span class="op">*</span>alpha<span class="op">*</span>x<span class="op">^</span>(alpha<span class="dv">-1</span>)}</span>
<span id="cb194-6"><a href="parametric-proportional-hazards-models.html#cb194-6"></a><span class="kw">lines</span>(x,<span class="kw">h</span>(x),<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb194-7"><a href="parametric-proportional-hazards-models.html#cb194-7"></a><span class="kw">abline</span>(<span class="dt">h=</span><span class="kw">exp</span>(<span class="kw">coef</span>(fit.e.ph)),<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">&quot;green&quot;</span>)</span></code></pre></div>
<p><img src="Survival_Analysis_files/figure-html/unnamed-chunk-111-1.png" width="100%" /></p>
<p>It is easier to estimate the <em>cumulative hazard</em> or <span class="math inline">\(H(t)\)</span> because it is a smooth function. The hazard function can be unstable when there are few events. Therefore it is more common to compare cumulative hazards function between models.</p>
<p>We plot the <em>Nelons-Aalen</em> non-parametric estimate of the cumulative hazard. Then we superimpose the Weibull estimate, and the exponential estimate. Here the exponential is <span class="math inline">\(H_E(t) = \lambda t\)</span> and the Weibull is <span class="math inline">\(H_W(t) = \mu t ^ \alpha\)</span>.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="parametric-proportional-hazards-models.html#cb195-1"></a>nelson.aalen &lt;-<span class="st"> </span><span class="kw">nelsonaalen</span>(wcgs,time169y,chd69)</span>
<span id="cb195-2"><a href="parametric-proportional-hazards-models.html#cb195-2"></a><span class="kw">plot</span>(wcgs<span class="op">$</span>time169y,nelson.aalen,<span class="dt">xlab=</span><span class="st">&quot;Time (t)&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;Cumulative Hazard H(t)&quot;</span>)</span>
<span id="cb195-3"><a href="parametric-proportional-hazards-models.html#cb195-3"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">9</span>,<span class="fl">0.1</span>)</span>
<span id="cb195-4"><a href="parametric-proportional-hazards-models.html#cb195-4"></a>alpha&lt;-<span class="kw">exp</span>(<span class="kw">coef</span>(fit.w.ph)[<span class="dv">1</span>])</span>
<span id="cb195-5"><a href="parametric-proportional-hazards-models.html#cb195-5"></a>mu&lt;-<span class="kw">exp</span>(<span class="kw">coef</span>(fit.w.ph)[<span class="dv">2</span>])</span>
<span id="cb195-6"><a href="parametric-proportional-hazards-models.html#cb195-6"></a>H &lt;-<span class="st"> </span><span class="cf">function</span>(x) {mu<span class="op">*</span>x<span class="op">^</span>alpha}</span>
<span id="cb195-7"><a href="parametric-proportional-hazards-models.html#cb195-7"></a><span class="kw">lines</span>(x,<span class="kw">H</span>(x),<span class="dt">col=</span><span class="st">&quot;green&quot;</span>,<span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb195-8"><a href="parametric-proportional-hazards-models.html#cb195-8"></a><span class="kw">lines</span>(x,<span class="kw">exp</span>(<span class="kw">coef</span>(fit.e.ph))<span class="op">*</span>x,<span class="dt">lwd=</span><span class="dv">2</span>,<span class="dt">lty=</span><span class="dv">2</span>,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="Survival_Analysis_files/figure-html/unnamed-chunk-112-1.png" width="100%" /></p>
<p>The Weibull version is much closer to the Nelson-Aalen estimate than the exponential. Note that the exponential is a special case of the Weibull when <span class="math inline">\(\alpha=1\)</span>.</p>
<p>Therefore if <em>log(shape)=0</em> or <em>shape=1</em>, then the Weibull becomes an exponential. From the output we see the test for <em>log(shape)=0</em>. We can also compare <em>log-likelihood</em> values, and show that below.</p>
<p>We can use a likelihood ratio test to compare the Weibull and the exponential. The difference is 1 parameter so we compare the 2 times difference in log likelihoods to the chi-square distribution with 1 degree of freedom.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="parametric-proportional-hazards-models.html#cb196-1"></a><span class="kw">qchisq</span>(<span class="fl">0.95</span>,<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 3.841459</code></pre>
<p>The difference is greater than the reference value from the chi-square distribution, and therefore we conclude that the Weibull model gives a better fit.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="parametric-proportional-hazards-models.html#cb198-1"></a><span class="dv">-2</span><span class="op">*</span>(fit.e.ph<span class="op">$</span>loglik <span class="op">-</span><span class="st"> </span>fit.w.ph<span class="op">$</span>loglik)</span></code></pre></div>
<pre><code>## [1] 17.2259</code></pre>
</div>
</div>
<div id="covariates-and-hazard-ratios" class="section level2">
<h2><span class="header-section-number">5.5</span> Covariates and Hazard ratios</h2>
<p>Consider the difference in hazard between the behavior types A and B. From a Poisson model we see that the rate ratio is 2.34.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="parametric-proportional-hazards-models.html#cb200-1"></a>futpb &lt;-<span class="st"> </span><span class="kw">tapply</span>(wcgs<span class="op">$</span>time169y,wcgs<span class="op">$</span>dibpat0f,sum)</span>
<span id="cb200-2"><a href="parametric-proportional-hazards-models.html#cb200-2"></a>enpb &lt;-<span class="st"> </span><span class="kw">tapply</span>(wcgs<span class="op">$</span>chd69,wcgs<span class="op">$</span>dibpat0f,sum)</span></code></pre></div>
<p>Number of events per 1000 person years by type:</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="parametric-proportional-hazards-models.html#cb201-1"></a>lambda&lt;-enpb<span class="op">/</span>futpb<span class="op">*</span><span class="dv">1000</span></span>
<span id="cb201-2"><a href="parametric-proportional-hazards-models.html#cb201-2"></a>lambda</span></code></pre></div>
<pre><code>##         B         A 
##  6.691579 15.654735</code></pre>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="parametric-proportional-hazards-models.html#cb203-1"></a>lambda[<span class="dv">2</span>]<span class="op">/</span>lambda[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>##        A 
## 2.339468</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="parametric-proportional-hazards-models.html#cb205-1"></a>fitdb &lt;-<span class="st"> </span><span class="kw">glm</span>(chd69 <span class="op">~</span><span class="st"> </span>dibpat0f<span class="op">+</span><span class="kw">offset</span>(<span class="kw">log</span>(time169y)),<span class="dt">data=</span>wcgs,<span class="dt">family=</span><span class="kw">poisson</span>())</span>
<span id="cb205-2"><a href="parametric-proportional-hazards-models.html#cb205-2"></a><span class="kw">summary</span>(fitdb)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = chd69 ~ dibpat0f + offset(log(time169y)), family = poisson(), 
##     data = wcgs)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.5415  -0.5023  -0.3360  -0.3251   3.7049  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -5.0069     0.1125 -44.502  &lt; 2e-16 ***
## dibpat0fA     0.8499     0.1352   6.287 3.24e-10 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 1656.5  on 3153  degrees of freedom
## Residual deviance: 1613.5  on 3152  degrees of freedom
## AIC: 2131.5
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="parametric-proportional-hazards-models.html#cb207-1"></a><span class="kw">exp</span>(<span class="kw">coef</span>(fitdb)[<span class="dv">2</span>])</span></code></pre></div>
<pre><code>## dibpat0fA 
##  2.339468</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="parametric-proportional-hazards-models.html#cb209-1"></a><span class="kw">exp</span>(<span class="kw">confint.default</span>(fitdb))[<span class="dv">2</span>,]</span></code></pre></div>
<pre><code>##    2.5 %   97.5 % 
## 1.794917 3.049228</code></pre>
<p>From the exponential (<span class="math inline">\(\alpha=1\)</span> or <em>shape=1</em>) we get:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="parametric-proportional-hazards-models.html#cb211-1"></a>fit.w1.ph.m1  &lt;-<span class="st"> </span><span class="kw">flexsurvreg</span>(<span class="kw">Surv</span>(time169y,chd69)<span class="op">~</span>dibpat0f,</span>
<span id="cb211-2"><a href="parametric-proportional-hazards-models.html#cb211-2"></a>                             <span class="dt">dist=</span><span class="st">&quot;exponential&quot;</span>,<span class="dt">data=</span>wcgs)</span>
<span id="cb211-3"><a href="parametric-proportional-hazards-models.html#cb211-3"></a>fit.w1.ph.m1</span></code></pre></div>
<pre><code>## Call:
## flexsurvreg(formula = Surv(time169y, chd69) ~ dibpat0f, data = wcgs, 
##     dist = &quot;exponential&quot;)
## 
## Estimates: 
##            data mean  est       L95%      U95%      se        exp(est)
## rate             NA   0.006692  0.005367  0.008343  0.000753        NA
## dibpat0fA  0.503805   0.849924  0.584957  1.114890  0.135190  2.339468
##            L95%      U95%    
## rate             NA        NA
## dibpat0fA  1.794914  3.049233
## 
## N = 3154,  Events: 257,  Censored: 2897
## Total time at risk: 23176.25
## Log-likelihood = -1392.488, df = 2
## AIC = 2788.977</code></pre>
<p>From the Weibull we get:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="parametric-proportional-hazards-models.html#cb213-1"></a>fit.w.ph.m1  &lt;-<span class="st"> </span><span class="kw">flexsurvreg</span>(<span class="kw">Surv</span>(time169y,chd69)<span class="op">~</span>dibpat0f,</span>
<span id="cb213-2"><a href="parametric-proportional-hazards-models.html#cb213-2"></a>                            <span class="dt">dist=</span><span class="st">&quot;weibullph&quot;</span>,</span>
<span id="cb213-3"><a href="parametric-proportional-hazards-models.html#cb213-3"></a>                            <span class="dt">data=</span>wcgs)</span>
<span id="cb213-4"><a href="parametric-proportional-hazards-models.html#cb213-4"></a>fit.w.ph.m1</span></code></pre></div>
<pre><code>## Call:
## flexsurvreg(formula = Surv(time169y, chd69) ~ dibpat0f, data = wcgs, 
##     dist = &quot;weibullph&quot;)
## 
## Estimates: 
##            data mean  est       L95%      U95%      se        exp(est)
## shape            NA   1.306045  1.160702  1.469588  0.078616        NA
## scale            NA   0.003570  0.002426  0.005253  0.000703        NA
## dibpat0fA  0.503805   0.856917  0.591934  1.121900  0.135198  2.355886
##            L95%      U95%    
## shape            NA        NA
## scale            NA        NA
## dibpat0fA  1.807481  3.070682
## 
## N = 3154,  Events: 257,  Censored: 2897
## Total time at risk: 23176.25
## Log-likelihood = -1383.514, df = 3
## AIC = 2773.028</code></pre>
<p>From the Weibull with age adjustment we get (here agec=age0-46):</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="parametric-proportional-hazards-models.html#cb215-1"></a>fit.w.ph.m2  &lt;-<span class="st"> </span><span class="kw">flexsurvreg</span>(<span class="kw">Surv</span>(time169y,chd69)<span class="op">~</span>dibpat0f<span class="op">+</span>agec,</span>
<span id="cb215-2"><a href="parametric-proportional-hazards-models.html#cb215-2"></a>                        <span class="dt">dist=</span><span class="st">&quot;weibullph&quot;</span>,</span>
<span id="cb215-3"><a href="parametric-proportional-hazards-models.html#cb215-3"></a>                        <span class="dt">data=</span>wcgs)</span>
<span id="cb215-4"><a href="parametric-proportional-hazards-models.html#cb215-4"></a>fit.w.ph.m2</span></code></pre></div>
<pre><code>## Call:
## flexsurvreg(formula = Surv(time169y, chd69) ~ dibpat0f + agec, 
##     data = wcgs, dist = &quot;weibullph&quot;)
## 
## Estimates: 
##            data mean  est       L95%      U95%      se        exp(est)
## shape            NA   1.314663  1.168553  1.479041  0.079025        NA
## scale            NA   0.003338  0.002261  0.004929  0.000664        NA
## dibpat0fA  0.503805   0.795310  0.529457  1.061162  0.135642  2.215126
## agec       0.278694   0.066254  0.045257  0.087251  0.010713  1.068498
##            L95%      U95%    
## shape            NA        NA
## scale            NA        NA
## dibpat0fA  1.698010  2.889727
## agec       1.046297  1.091171
## 
## N = 3154,  Events: 257,  Censored: 2897
## Total time at risk: 23176.25
## Log-likelihood = -1364.788, df = 4
## AIC = 2737.577</code></pre>
<p>Be sure to understand the parametric form of the <em>flexsurvreg</em> function. In general we have
<span class="math display">\[
h(t) = \mu \alpha t ^ {\alpha-1} \exp(\beta_1 x_1 + \cdots + \beta_p x_p),
\]</span>
where <span class="math inline">\(x_1,\ldots,x_p\)</span> are explanatory variables, and <span class="math inline">\(h_0(t)=\mu \alpha t ^ {\alpha-1}\)</span>.</p>
<p>Sometimes we write <span class="math inline">\(\mu=exp(\beta_0)\)</span> and then
<span class="math display">\[
h(t) =\alpha t ^ {\alpha-1} \exp(\beta_0 +\beta_1 x_1 + \cdots + \beta_p x_p),
\]</span></p>
<p>Consider and example. Let <span class="math inline">\(x\)</span> be a <em>dummy</em> explanatory variable for the behavior <em>A</em> or <em>B</em>. Let <span class="math inline">\(x_1=1\)</span> if the type is <em>A</em> and <span class="math inline">\(x_1=0\)</span> if the type is <em>B</em>. Let <span class="math inline">\(x_2=0\)</span> meaning that agem=0 or age0=46.</p>
<p>For <em>B</em> of age 46 (the reference group) we get:
<span class="math display">\[
h_B(t)=h_0(t) = \mu \alpha t ^ {a-1}.
\]</span></p>
<p>For <em>A</em> of age 46 we get
<span class="math display">\[
h_A(t) =\mu \alpha t ^ {a-1} \exp(\beta_1).
\]</span></p>
<p>The hazard ratio (<strong>H</strong>azard <strong>R</strong>atio = HR) for <em>A</em> vs <em>B</em> is
<span class="math display">\[
HR = h_A(t) / h_B(t) = \exp(\beta_1).
\]</span></p>
<p>Let’s consider the effect of age, where <span class="math inline">\(x_2\)</span> is the age variable. Then <span class="math inline">\(h(t)\)</span> for <em>B</em> of age <span class="math inline">\(k\)</span> is
<span class="math display">\[
h_B(t) = \mu \alpha t ^ {a-1} \exp(\beta_2  k),
\]</span></p>
<p>and <span class="math inline">\(h(t)\)</span> for an <em>A</em>-type, also of age <span class="math inline">\(k\)</span> units from 46, we get
<span class="math display">\[
h_A(t) = \mu \alpha t ^ {a-1} \exp(\beta_1 + \beta_2  k).
\]</span>
The cumulative hazard for A given age of k units from 46 is:
<span class="math display">\[
H_A(t) = \mu  t ^ {a} \exp(\beta_1 + \beta_2  k).
\]</span></p>
<p>The adjusted hazard ratio for <em>A</em> vs <em>B</em> is:
<span class="math display">\[
HR = h_A(t) / h_B(t) = \exp(\beta_1).
\]</span></p>
<p>The formula is the same, but the estimate of <span class="math inline">\(\beta_1\)</span> could be different if the hazard depends on age and there is an age difference between the groups (in other words, confounding is present).</p>
<p>Recall that <span class="math inline">\(exp(y)/exp(z) = exp(y-z)\)</span>.</p>
<p>The age variable cancels in hazard ratio computations because we assume the effect of age is same for <em>A</em> and <em>B</em>. We could study that by introducing <strong>interaction</strong> between age and behavior.</p>
<p>Let’s plot the cumulative hazards for the A and B types. We show the Nelson-Aalen and the Weibull, with and without age adjustment.</p>
<p>We have to use the <em>order</em> function to sort the time values. Be sure to understand the the form of <span class="math inline">\(H_W(t)\)</span> for the A group.</p>
<p>First we use the unadjusted Weibull model.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="parametric-proportional-hazards-models.html#cb217-1"></a>wcgsA &lt;-<span class="st"> </span><span class="kw">subset</span>(wcgs,dibpat0f<span class="op">==</span><span class="st">&quot;A&quot;</span>)</span>
<span id="cb217-2"><a href="parametric-proportional-hazards-models.html#cb217-2"></a>wcgsB &lt;-<span class="st"> </span><span class="kw">subset</span>(wcgs,dibpat0f<span class="op">==</span><span class="st">&quot;B&quot;</span>)</span>
<span id="cb217-3"><a href="parametric-proportional-hazards-models.html#cb217-3"></a>nelson.aalenA &lt;-<span class="st"> </span><span class="kw">nelsonaalen</span>(wcgsA,time169y,chd69)</span>
<span id="cb217-4"><a href="parametric-proportional-hazards-models.html#cb217-4"></a>nelson.aalenB &lt;-<span class="st"> </span><span class="kw">nelsonaalen</span>(wcgsB,time169y,chd69)</span>
<span id="cb217-5"><a href="parametric-proportional-hazards-models.html#cb217-5"></a>oA &lt;-<span class="st"> </span><span class="kw">order</span>(wcgsA<span class="op">$</span>time169y)</span>
<span id="cb217-6"><a href="parametric-proportional-hazards-models.html#cb217-6"></a>oB &lt;-<span class="st"> </span><span class="kw">order</span>(wcgsB<span class="op">$</span>time169y)</span>
<span id="cb217-7"><a href="parametric-proportional-hazards-models.html#cb217-7"></a><span class="kw">plot</span>(wcgsA<span class="op">$</span>time169y[oA],nelson.aalenA[oA],<span class="dt">xlab=</span><span class="st">&quot;Time&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;H(t)&quot;</span>,<span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb217-8"><a href="parametric-proportional-hazards-models.html#cb217-8"></a><span class="kw">lines</span>(wcgsB<span class="op">$</span>time169y[oB],nelson.aalenB[oB])</span>
<span id="cb217-9"><a href="parametric-proportional-hazards-models.html#cb217-9"></a></span>
<span id="cb217-10"><a href="parametric-proportional-hazards-models.html#cb217-10"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">9</span>,<span class="fl">0.1</span>)</span>
<span id="cb217-11"><a href="parametric-proportional-hazards-models.html#cb217-11"></a><span class="co">#  H_0(t)</span></span>
<span id="cb217-12"><a href="parametric-proportional-hazards-models.html#cb217-12"></a>mu &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">coef</span>(fit.w.ph.m1)[<span class="dv">2</span>])</span>
<span id="cb217-13"><a href="parametric-proportional-hazards-models.html#cb217-13"></a>alpha &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">coef</span>(fit.w.ph.m1)[<span class="dv">1</span>])</span>
<span id="cb217-14"><a href="parametric-proportional-hazards-models.html#cb217-14"></a>H0 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {mu<span class="op">*</span>x<span class="op">^</span>alpha}</span>
<span id="cb217-15"><a href="parametric-proportional-hazards-models.html#cb217-15"></a><span class="kw">lines</span>(x,<span class="kw">H0</span>(x),<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,<span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb217-16"><a href="parametric-proportional-hazards-models.html#cb217-16"></a><span class="kw">lines</span>(x,<span class="kw">H0</span>(x) <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="fl">0.857</span>),<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Survival_Analysis_files/figure-html/unnamed-chunk-121-1.png" width="100%" /></p>
<p>Now use age adjustment (with respect to age 46). Then agec=0.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="parametric-proportional-hazards-models.html#cb218-1"></a>wcgsA &lt;-<span class="st"> </span><span class="kw">subset</span>(wcgs,dibpat0f<span class="op">==</span><span class="st">&quot;A&quot;</span>)</span>
<span id="cb218-2"><a href="parametric-proportional-hazards-models.html#cb218-2"></a>wcgsB &lt;-<span class="st"> </span><span class="kw">subset</span>(wcgs,dibpat0f<span class="op">==</span><span class="st">&quot;B&quot;</span>)</span>
<span id="cb218-3"><a href="parametric-proportional-hazards-models.html#cb218-3"></a>nelson.aalenA &lt;-<span class="st"> </span><span class="kw">nelsonaalen</span>(wcgsA,time169y,chd69)</span>
<span id="cb218-4"><a href="parametric-proportional-hazards-models.html#cb218-4"></a>nelson.aalenB &lt;-<span class="st"> </span><span class="kw">nelsonaalen</span>(wcgsB,time169y,chd69)</span>
<span id="cb218-5"><a href="parametric-proportional-hazards-models.html#cb218-5"></a>oA &lt;-<span class="st"> </span><span class="kw">order</span>(wcgsA<span class="op">$</span>time169y)</span>
<span id="cb218-6"><a href="parametric-proportional-hazards-models.html#cb218-6"></a>oB &lt;-<span class="st"> </span><span class="kw">order</span>(wcgsB<span class="op">$</span>time169y)</span>
<span id="cb218-7"><a href="parametric-proportional-hazards-models.html#cb218-7"></a><span class="kw">plot</span>(wcgsA<span class="op">$</span>time169y[oA],nelson.aalenA[oA],<span class="dt">xlab=</span><span class="st">&quot;Time&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;H(t)&quot;</span>,<span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb218-8"><a href="parametric-proportional-hazards-models.html#cb218-8"></a><span class="kw">lines</span>(wcgsB<span class="op">$</span>time169y[oB],nelson.aalenB[oB])</span>
<span id="cb218-9"><a href="parametric-proportional-hazards-models.html#cb218-9"></a></span>
<span id="cb218-10"><a href="parametric-proportional-hazards-models.html#cb218-10"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">9</span>,<span class="fl">0.1</span>)</span>
<span id="cb218-11"><a href="parametric-proportional-hazards-models.html#cb218-11"></a>mu &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">coef</span>(fit.w.ph.m2)[<span class="dv">2</span>])</span>
<span id="cb218-12"><a href="parametric-proportional-hazards-models.html#cb218-12"></a>alpha &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">coef</span>(fit.w.ph.m2)[<span class="dv">1</span>])</span>
<span id="cb218-13"><a href="parametric-proportional-hazards-models.html#cb218-13"></a>H0 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {mu<span class="op">*</span>x<span class="op">^</span>alpha}</span>
<span id="cb218-14"><a href="parametric-proportional-hazards-models.html#cb218-14"></a><span class="kw">lines</span>(x,<span class="kw">H0</span>(x) ,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,<span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb218-15"><a href="parametric-proportional-hazards-models.html#cb218-15"></a><span class="kw">lines</span>(x,<span class="kw">H0</span>(x) <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="fl">0.795</span>),<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Survival_Analysis_files/figure-html/unnamed-chunk-122-1.png" width="100%" /></p>
<p>Note that the red line is below the un-adjusted estimate. This is the effect of the age adjustment. The A group was slightly older. The difference between the groups has now been adjusted for age.</p>
<p>Mean age of the <em>A</em> and <em>B</em> types:</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="parametric-proportional-hazards-models.html#cb219-1"></a><span class="kw">tapply</span>(wcgs<span class="op">$</span>age0,wcgs<span class="op">$</span>dibpat0f,mean)</span></code></pre></div>
<pre><code>##        B        A 
## 45.78722 46.76274</code></pre>
<p>Let’s inspect age adjustment to age 50. Then agec=4.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="parametric-proportional-hazards-models.html#cb221-1"></a>wcgsA &lt;-<span class="st"> </span><span class="kw">subset</span>(wcgs,dibpat0f<span class="op">==</span><span class="st">&quot;A&quot;</span>)</span>
<span id="cb221-2"><a href="parametric-proportional-hazards-models.html#cb221-2"></a>wcgsB &lt;-<span class="st"> </span><span class="kw">subset</span>(wcgs,dibpat0f<span class="op">==</span><span class="st">&quot;B&quot;</span>)</span>
<span id="cb221-3"><a href="parametric-proportional-hazards-models.html#cb221-3"></a>nelson.aalenA &lt;-<span class="st"> </span><span class="kw">nelsonaalen</span>(wcgsA,time169y,chd69)</span>
<span id="cb221-4"><a href="parametric-proportional-hazards-models.html#cb221-4"></a>nelson.aalenB &lt;-<span class="st"> </span><span class="kw">nelsonaalen</span>(wcgsB,time169y,chd69)</span>
<span id="cb221-5"><a href="parametric-proportional-hazards-models.html#cb221-5"></a>oA &lt;-<span class="st"> </span><span class="kw">order</span>(wcgsA<span class="op">$</span>time169y)</span>
<span id="cb221-6"><a href="parametric-proportional-hazards-models.html#cb221-6"></a>oB &lt;-<span class="st"> </span><span class="kw">order</span>(wcgsB<span class="op">$</span>time169y)</span>
<span id="cb221-7"><a href="parametric-proportional-hazards-models.html#cb221-7"></a><span class="kw">plot</span>(wcgsA<span class="op">$</span>time169y[oA],nelson.aalenA[oA],<span class="dt">xlab=</span><span class="st">&quot;Time&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;H(t)&quot;</span>,<span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb221-8"><a href="parametric-proportional-hazards-models.html#cb221-8"></a><span class="kw">lines</span>(wcgsB<span class="op">$</span>time169y[oB],nelson.aalenB[oB])</span>
<span id="cb221-9"><a href="parametric-proportional-hazards-models.html#cb221-9"></a></span>
<span id="cb221-10"><a href="parametric-proportional-hazards-models.html#cb221-10"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">9</span>,<span class="fl">0.1</span>)</span>
<span id="cb221-11"><a href="parametric-proportional-hazards-models.html#cb221-11"></a><span class="co">#  H_W(t)</span></span>
<span id="cb221-12"><a href="parametric-proportional-hazards-models.html#cb221-12"></a><span class="kw">lines</span>(x,<span class="kw">H0</span>(x) <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="fl">0.066</span><span class="op">*</span><span class="dv">4</span>),<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,<span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb221-13"><a href="parametric-proportional-hazards-models.html#cb221-13"></a><span class="kw">lines</span>(x,<span class="kw">H0</span>(x) <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="fl">0.795</span> <span class="op">+</span><span class="st"> </span><span class="fl">0.066</span><span class="op">*</span><span class="dv">4</span>),<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="Survival_Analysis_files/figure-html/unnamed-chunk-124-1.png" width="100%" /></p>
<p>The lines are now above the un-adjusted lines.</p>
<p>These are so called model based survival curves. We prefer conditional or standardized survival curves. However, this has not been implemented for <em>flexsurvreg</em>.</p>
</div>
<div id="test-of-interaction-using-flexurvreg" class="section level2">
<h2><span class="header-section-number">5.6</span> Test of interaction using flexurvreg</h2>
<p>Is there an interaction between age and type?</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="parametric-proportional-hazards-models.html#cb222-1"></a>fit.w.ph.m3  &lt;-<span class="st"> </span><span class="kw">flexsurvreg</span>(<span class="kw">Surv</span>(time169y,chd69)<span class="op">~</span>dibpat0f<span class="op">+</span>agec<span class="op">+</span>dibpat0f<span class="op">:</span>agec,<span class="dt">dist=</span><span class="st">&quot;weibull&quot;</span>,<span class="dt">data=</span>wcgs)</span>
<span id="cb222-2"><a href="parametric-proportional-hazards-models.html#cb222-2"></a>fit.w.ph.m3</span></code></pre></div>
<pre><code>## Call:
## flexsurvreg(formula = Surv(time169y, chd69) ~ dibpat0f + agec + 
##     dibpat0f:agec, data = wcgs, dist = &quot;weibull&quot;)
## 
## Estimates: 
##                 data mean  est       L95%      U95%      se        exp(est)
## shape                 NA     1.3149    1.1688    1.4793    0.0790        NA
## scale                 NA    75.8117   55.1061  104.2971   12.3386        NA
## dibpat0fA         0.5038    -0.5897   -0.8140   -0.3654    0.1145    0.5545
## agec              0.2787    -0.0451   -0.0750   -0.0152    0.0153    0.9559
## dibpat0fA:agec    0.3843    -0.0075   -0.0426    0.0276    0.0179    0.9925
##                 L95%      U95%    
## shape                 NA        NA
## scale                 NA        NA
## dibpat0fA         0.4431    0.6939
## agec              0.9277    0.9849
## dibpat0fA:agec    0.9583    1.0280
## 
## N = 3154,  Events: 257,  Censored: 2897
## Total time at risk: 23176.25
## Log-likelihood = -1364.7, df = 5
## AIC = 2739.401</code></pre>
<p>The difference in -2 times likelihood is</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="parametric-proportional-hazards-models.html#cb224-1"></a>ll &lt;-<span class="st"> </span><span class="dv">-2</span><span class="op">*</span>(<span class="kw">logLik</span>(fit.w.ph.m2) <span class="op">-</span><span class="st"> </span><span class="kw">logLik</span>(fit.w.ph.m3))</span>
<span id="cb224-2"><a href="parametric-proportional-hazards-models.html#cb224-2"></a>ll</span></code></pre></div>
<pre><code>## &#39;log Lik.&#39; 0.1759378 (df=4)</code></pre>
<p>The p-value is</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="parametric-proportional-hazards-models.html#cb226-1"></a><span class="dv">1</span><span class="op">-</span><span class="kw">pchisq</span>(ll,<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## &#39;log Lik.&#39; 0.6748878 (df=4)</code></pre>
<p>The interaction term is not statistically significant. Therefore we do not have evidence for an interaction, so the effect of age does not depend on the behavior type. We drop the term <em>dibpat0f:agem</em> from the model.</p>
</div>
<div id="comparison-with-a-cox-model" class="section level2">
<h2><span class="header-section-number">5.7</span> Comparison with a Cox model</h2>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="parametric-proportional-hazards-models.html#cb228-1"></a>fit.cox.ph.m3  &lt;-<span class="st"> </span><span class="kw">coxph</span>(<span class="kw">Surv</span>(time169y,chd69)<span class="op">~</span>dibpat0f<span class="op">+</span>agec<span class="op">+</span>dibpat0f<span class="op">:</span>agec,</span>
<span id="cb228-2"><a href="parametric-proportional-hazards-models.html#cb228-2"></a>                        <span class="dt">data=</span>wcgs)</span>
<span id="cb228-3"><a href="parametric-proportional-hazards-models.html#cb228-3"></a>fit.cox.ph.m3</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(time169y, chd69) ~ dibpat0f + agec + dibpat0f:agec, 
##     data = wcgs)
## 
##                   coef exp(coef) se(coef)     z        p
## dibpat0fA      0.76521   2.14944  0.14362 5.328 9.92e-08
## agec           0.06024   1.06209  0.01977 3.047  0.00232
## dibpat0fA:agec 0.01064   1.01070  0.02355 0.452  0.65135
## 
## Likelihood ratio test=81.97  on 3 df, p=&lt; 2.2e-16
## n= 3154, number of events= 257</code></pre>
<p>The interaction is not signficant. The reduced model is</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="parametric-proportional-hazards-models.html#cb230-1"></a>fit.cox.ph.m2 &lt;-<span class="st"> </span><span class="kw">update</span>(fit.cox.ph.m3,.<span class="op">~</span>.<span class="op">-</span>dibpat0f<span class="op">:</span>agec)</span>
<span id="cb230-2"><a href="parametric-proportional-hazards-models.html#cb230-2"></a>fit.cox.ph.m2 </span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(time169y, chd69) ~ dibpat0f + agec, data = wcgs)
## 
##              coef exp(coef) se(coef)     z        p
## dibpat0fA 0.78679   2.19634  0.13567 5.799 6.65e-09
## agec      0.06772   1.07007  0.01074 6.306 2.86e-10
## 
## Likelihood ratio test=81.76  on 2 df, p=&lt; 2.2e-16
## n= 3154, number of events= 257</code></pre>
<p>Comparing the HRs</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="parametric-proportional-hazards-models.html#cb232-1"></a><span class="kw">data.frame</span>(<span class="dt">cox=</span><span class="kw">exp</span>(<span class="kw">coef</span>(fit.cox.ph.m2)),<span class="dt">weibull=</span><span class="kw">exp</span>(<span class="kw">coef</span>(fit.w.ph.m2)[<span class="dv">3</span><span class="op">:</span><span class="dv">4</span>]))</span></code></pre></div>
<pre><code>##                cox  weibull
## dibpat0fA 2.196337 2.215126
## agec      1.070068 1.068498</code></pre>
<p>Add the Cox estimates</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="parametric-proportional-hazards-models.html#cb234-1"></a>wcgsA &lt;-<span class="st"> </span><span class="kw">subset</span>(wcgs,dibpat0f<span class="op">==</span><span class="st">&quot;A&quot;</span>)</span>
<span id="cb234-2"><a href="parametric-proportional-hazards-models.html#cb234-2"></a>wcgsB &lt;-<span class="st"> </span><span class="kw">subset</span>(wcgs,dibpat0f<span class="op">==</span><span class="st">&quot;B&quot;</span>)</span>
<span id="cb234-3"><a href="parametric-proportional-hazards-models.html#cb234-3"></a>nelson.aalenA &lt;-<span class="st"> </span><span class="kw">nelsonaalen</span>(wcgsA,time169y,chd69)</span>
<span id="cb234-4"><a href="parametric-proportional-hazards-models.html#cb234-4"></a>nelson.aalenB &lt;-<span class="st"> </span><span class="kw">nelsonaalen</span>(wcgsB,time169y,chd69)</span>
<span id="cb234-5"><a href="parametric-proportional-hazards-models.html#cb234-5"></a>oA &lt;-<span class="st"> </span><span class="kw">order</span>(wcgsA<span class="op">$</span>time169y)</span>
<span id="cb234-6"><a href="parametric-proportional-hazards-models.html#cb234-6"></a>oB &lt;-<span class="st"> </span><span class="kw">order</span>(wcgsB<span class="op">$</span>time169y)</span>
<span id="cb234-7"><a href="parametric-proportional-hazards-models.html#cb234-7"></a><span class="kw">plot</span>(wcgsA<span class="op">$</span>time169y[oA],nelson.aalenA[oA],<span class="dt">xlab=</span><span class="st">&quot;Time&quot;</span>,<span class="dt">ylab=</span><span class="st">&quot;H(t)&quot;</span>,<span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb234-8"><a href="parametric-proportional-hazards-models.html#cb234-8"></a><span class="kw">lines</span>(wcgsB<span class="op">$</span>time169y[oB],nelson.aalenB[oB])</span>
<span id="cb234-9"><a href="parametric-proportional-hazards-models.html#cb234-9"></a></span>
<span id="cb234-10"><a href="parametric-proportional-hazards-models.html#cb234-10"></a>x &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">9</span>,<span class="fl">0.1</span>)</span>
<span id="cb234-11"><a href="parametric-proportional-hazards-models.html#cb234-11"></a>mu &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">coef</span>(fit.w.ph.m2)[<span class="dv">2</span>])</span>
<span id="cb234-12"><a href="parametric-proportional-hazards-models.html#cb234-12"></a>alpha &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">coef</span>(fit.w.ph.m2)[<span class="dv">1</span>])</span>
<span id="cb234-13"><a href="parametric-proportional-hazards-models.html#cb234-13"></a>H0 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {mu<span class="op">*</span>x<span class="op">^</span>alpha}</span>
<span id="cb234-14"><a href="parametric-proportional-hazards-models.html#cb234-14"></a><span class="kw">lines</span>(x,<span class="kw">H0</span>(x) ,<span class="dt">col=</span><span class="st">&quot;blue&quot;</span>,<span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb234-15"><a href="parametric-proportional-hazards-models.html#cb234-15"></a><span class="kw">lines</span>(x,<span class="kw">H0</span>(x) <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="fl">0.795</span>),<span class="dt">col=</span><span class="st">&quot;red&quot;</span>,<span class="dt">lwd=</span><span class="dv">2</span>)</span>
<span id="cb234-16"><a href="parametric-proportional-hazards-models.html#cb234-16"></a><span class="co"># Baseline Cox</span></span>
<span id="cb234-17"><a href="parametric-proportional-hazards-models.html#cb234-17"></a>coxB &lt;-<span class="st"> </span><span class="kw">survfit</span>(fit.cox.ph.m2,<span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">agec=</span><span class="dv">0</span>,<span class="dt">dibpat0f=</span><span class="st">&quot;B&quot;</span>))</span>
<span id="cb234-18"><a href="parametric-proportional-hazards-models.html#cb234-18"></a><span class="kw">lines</span>(coxB<span class="op">$</span>time,coxB<span class="op">$</span>cumhaz,<span class="dt">col=</span><span class="st">&quot;green&quot;</span>)</span>
<span id="cb234-19"><a href="parametric-proportional-hazards-models.html#cb234-19"></a><span class="kw">lines</span>(coxB<span class="op">$</span>time,coxB<span class="op">$</span>cumhaz<span class="op">*</span><span class="kw">exp</span>(<span class="kw">coef</span>(fit.cox.ph.m2)[<span class="dv">1</span>]),<span class="dt">col=</span><span class="st">&quot;orange&quot;</span>)</span></code></pre></div>
<p><img src="Survival_Analysis_files/figure-html/unnamed-chunk-131-1.png" width="100%" /></p>
</div>
<div id="estimating-risk" class="section level2">
<h2><span class="header-section-number">5.8</span> Estimating risk</h2>
<p>What is the 5 year risk of CHD for type A who is 49 years of age?</p>
<p>First we define the risk function.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="parametric-proportional-hazards-models.html#cb235-1"></a>chd.risk &lt;-<span class="st"> </span><span class="cf">function</span>(t,wfit,vars)</span>
<span id="cb235-2"><a href="parametric-proportional-hazards-models.html#cb235-2"></a>{</span>
<span id="cb235-3"><a href="parametric-proportional-hazards-models.html#cb235-3"></a>  mu &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">coef</span>(wfit)[<span class="dv">2</span>])</span>
<span id="cb235-4"><a href="parametric-proportional-hazards-models.html#cb235-4"></a>  alpha &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">coef</span>(wfit)[<span class="dv">1</span>])</span>
<span id="cb235-5"><a href="parametric-proportional-hazards-models.html#cb235-5"></a>  H0 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {mu<span class="op">*</span>x<span class="op">^</span>alpha}</span>
<span id="cb235-6"><a href="parametric-proportional-hazards-models.html#cb235-6"></a>  S0 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {<span class="kw">exp</span>(<span class="op">-</span><span class="kw">H0</span>(x))}</span>
<span id="cb235-7"><a href="parametric-proportional-hazards-models.html#cb235-7"></a>  H &lt;-<span class="st"> </span><span class="kw">H0</span>(t) <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">sum</span>(vars<span class="op">*</span><span class="kw">coef</span>(wfit)[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)]))</span>
<span id="cb235-8"><a href="parametric-proportional-hazards-models.html#cb235-8"></a>  <span class="dv">1</span><span class="op">-</span><span class="kw">S0</span>(t)<span class="op">^</span><span class="kw">exp</span>(<span class="kw">sum</span>(vars<span class="op">*</span><span class="kw">coef</span>(wfit)[<span class="op">-</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)]))</span>
<span id="cb235-9"><a href="parametric-proportional-hazards-models.html#cb235-9"></a>}</span></code></pre></div>
<p>Then we have to supply the appropriate covariate values. Note that 0 means type B and 1 means type A.</p>
<p>According to the Weibull model we have for type A of age 46.8 and 49 (49-46=3):</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="parametric-proportional-hazards-models.html#cb236-1"></a><span class="kw">chd.risk</span>(<span class="dv">5</span>,fit.w.ph.m2,<span class="kw">c</span>(<span class="dv">1</span>,<span class="fl">0.8</span>))</span></code></pre></div>
<pre><code>##      scale 
## 0.06264133</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="parametric-proportional-hazards-models.html#cb238-1"></a><span class="kw">chd.risk</span>(<span class="dv">5</span>,fit.w.ph.m2,<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span></code></pre></div>
<pre><code>##      scale 
## 0.07210822</code></pre>
<p>According to the Weibull model we have for type B of age 45.8 and 49 (49-46=3):</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="parametric-proportional-hazards-models.html#cb240-1"></a><span class="kw">chd.risk</span>(<span class="dv">5</span>,fit.w.ph.m2,<span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span>.<span class="dv">2</span>))</span></code></pre></div>
<pre><code>##      scale 
## 0.02696116</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="parametric-proportional-hazards-models.html#cb242-1"></a><span class="kw">chd.risk</span>(<span class="dv">5</span>,fit.w.ph.m2,<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3</span>))</span></code></pre></div>
<pre><code>##      scale 
## 0.03322159</code></pre>
<p>From a Kaplan Meier model we get the unadjusted values for each type as:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="parametric-proportional-hazards-models.html#cb244-1"></a>km.fit &lt;-<span class="st"> </span><span class="kw">survfit</span>(<span class="kw">Surv</span>(time169y,chd69)<span class="op">~</span>dibpat0f,<span class="dt">data=</span>wcgs)</span>
<span id="cb244-2"><a href="parametric-proportional-hazards-models.html#cb244-2"></a><span class="dv">1</span><span class="op">-</span><span class="kw">summary</span>(km.fit,<span class="dt">times=</span><span class="dv">5</span>)<span class="op">$</span>surv</span></code></pre></div>
<pre><code>## [1] 0.02512947 0.06592613</code></pre>
<p>We can also create the risk function for the Cox model using basehaz. We use approxfun to build a function based on the results from basehaz.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="parametric-proportional-hazards-models.html#cb246-1"></a>chd.risk.cox &lt;-<span class="st"> </span><span class="cf">function</span>(t,cfit,vars)</span>
<span id="cb246-2"><a href="parametric-proportional-hazards-models.html#cb246-2"></a>{</span>
<span id="cb246-3"><a href="parametric-proportional-hazards-models.html#cb246-3"></a>  bs.cox &lt;-<span class="st"> </span><span class="kw">basehaz</span>(cfit,<span class="dt">centered =</span> <span class="ot">FALSE</span>)</span>
<span id="cb246-4"><a href="parametric-proportional-hazards-models.html#cb246-4"></a>  H0 &lt;-<span class="st"> </span><span class="kw">approxfun</span>(bs.cox<span class="op">$</span>time,bs.cox<span class="op">$</span>hazard)</span>
<span id="cb246-5"><a href="parametric-proportional-hazards-models.html#cb246-5"></a>  S0 &lt;-<span class="st"> </span><span class="cf">function</span>(t) {<span class="kw">exp</span>(<span class="op">-</span><span class="kw">H0</span>(t))}</span>
<span id="cb246-6"><a href="parametric-proportional-hazards-models.html#cb246-6"></a>  <span class="dv">1</span><span class="op">-</span><span class="kw">S0</span>(t) <span class="op">^</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">sum</span>(vars<span class="op">*</span><span class="kw">coef</span>(cfit)))</span>
<span id="cb246-7"><a href="parametric-proportional-hazards-models.html#cb246-7"></a>}</span></code></pre></div>
<p>According to the Cox model we have for type B of age 45.8 and 49 (49-46=3):</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="parametric-proportional-hazards-models.html#cb247-1"></a><span class="kw">chd.risk.cox</span>(<span class="dv">5</span>,fit.cox.ph.m2,<span class="kw">c</span>(<span class="dv">0</span>,<span class="op">-</span>.<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## [1] 0.02580958</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="parametric-proportional-hazards-models.html#cb249-1"></a><span class="kw">chd.risk.cox</span>(<span class="dv">5</span>,fit.cox.ph.m2,<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">3</span>))</span></code></pre></div>
<pre><code>## [1] 0.03195436</code></pre>
<p>All 2-way interactions</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="parametric-proportional-hazards-models.html#cb251-1"></a>fit.cox.all2 &lt;-<span class="st"> </span><span class="kw">coxph</span>(<span class="kw">Surv</span>(time169y,chd69)<span class="op">~</span>(age0<span class="op">+</span>sbp0<span class="op">+</span>smoker<span class="op">+</span>dibpat0f)<span class="op">^</span><span class="dv">2</span>,<span class="dt">data=</span>wcgs)</span>
<span id="cb251-2"><a href="parametric-proportional-hazards-models.html#cb251-2"></a><span class="kw">drop1</span>(fit.cox.all2,<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</span></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## Surv(time169y, chd69) ~ (age0 + sbp0 + smoker + dibpat0f)^2
##                 Df    AIC     LRT Pr(&gt;Chi)  
## &lt;none&gt;             3909.1                   
## age0:sbp0        1 3907.8 0.61683  0.43223  
## age0:smoker      1 3907.8 0.66769  0.41386  
## age0:dibpat0f    1 3907.5 0.32199  0.57041  
## sbp0:smoker      1 3907.1 0.00473  0.94517  
## sbp0:dibpat0f    1 3908.9 1.77936  0.18223  
## smoker:dibpat0f  1 3909.9 2.74634  0.09748 .
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We do not have any statistically signficant interactions here.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="model-checking-in-the-cox-regression-model.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="time-dependent-variables-and-covariates.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Survival_Analysis.pdf", "Survival_Analysis.epub"],
"toc": {
"collapse": "subsection"
},
"code_folding": "hide"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
